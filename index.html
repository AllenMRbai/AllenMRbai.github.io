<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="记录学习的过程">
<meta name="keywords" content="blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Allen&#39;s Notes">
<meta property="og:url" content="https://allenmrbai.github.io/index.html">
<meta property="og:site_name" content="Allen&#39;s Notes">
<meta property="og:description" content="记录学习的过程">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Allen&#39;s Notes">
<meta name="twitter:description" content="记录学习的过程">






  <link rel="canonical" href="https://allenmrbai.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Allen's Notes</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Allen's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Quik notes</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2025/04/24/pnpm-env-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2025/04/24/pnpm-env-use/" class="post-title-link" itemprop="url">使用 pnpm 替代 nvm 进行 Node 版本管理</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2025-04-24 19:20:05 / 更新于：20:12:36" itemprop="dateCreated datePublished" datetime="2025-04-24T19:20:05+08:00">2025-04-24</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>日常工作中，我们经常需要在不同的项目中使用不同的 Node.js 版本。pnpm 提供了一个非常方便的命令 <code>pnpm env use &lt;node-version&gt;</code> 来切换 Node.js 版本。可以帮助我们轻松地在不同的项目中切换 Node.js 版本，这样我们就不需要单独下载 nvm 了。</p>
<h2 id="安装-pnpm"><a href="#安装-pnpm" class="headerlink" title="安装 pnpm"></a>安装 pnpm</h2><p>有个注意事项，你通过 <code>npm i -g pnpm</code> 的形式安装是没有 <code>pnpm env use</code> 命令的。需要通过以下几种方式安装才行（如果你已经安装了 nvm，可以参考这个<a href="https://github.com/nvm-sh/nvm/issues/298" target="_blank" rel="noopener">链接</a>删除 nvm，然后再安装 pnpm）：</p>
<h3 id="在-Windows-上安装-pnpm"><a href="#在-Windows-上安装-pnpm" class="headerlink" title="在 Windows 上安装 pnpm"></a>在 Windows 上安装 pnpm</h3><p>使用 PowerShell：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest https://get.pnpm.io/install.ps1 -UseBasicParsing | Invoke-Expression</span><br></pre></td></tr></table></figure>
<p><a href="https://www.pnpm.cn/installation#%E5%9C%A8-windows-%E4%B8%8A" target="_blank" rel="noopener">原官网文档地址</a></p>
<h3 id="在-POSIX-系统上"><a href="#在-POSIX-系统上" class="headerlink" title="在 POSIX 系统上"></a>在 POSIX 系统上</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.pnpm.io/install.sh | sh -</span><br></pre></td></tr></table></figure>
<p>如果你没有安装 curl，也可以使用 wget：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://get.pnpm.io/install.sh | sh -</span><br></pre></td></tr></table></figure>
<p><a href="https://www.pnpm.cn/installation#%E5%9C%A8-posix-%E7%B3%BB%E7%BB%9F%E4%B8%8A" target="_blank" rel="noopener">原官网文档地址</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>安装完毕需要重启下命令行工具（或者用 <code>source ~/.bashrc</code> or <code>source ~/.zshrc</code> or <code>source ~/.bash_profile</code> 等命令使配置生效），然后执行 <code>pnpm -v</code> 就可以看到版本号了。</p>
<p>如果你要切换 node 到版本 22 可以执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pnpm env use --global 22</span><br><span class="line"></span><br><span class="line">node -v # v22.15.0</span><br></pre></td></tr></table></figure>
<p>切换 node 到版本 16 可以执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pnpm env use --global 16</span><br><span class="line"></span><br><span class="line">node -v # v16.20.2</span><br></pre></td></tr></table></figure>
<p>还有一个小技巧，如果某个项目安装命令需要 pnpm 版本为 8，node 版本为 16，那么可以执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pnpm env use --global 16</span><br><span class="line"></span><br><span class="line">npx pnpm@8 install</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/vue-slots-and-scopedslots/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/vue-slots-and-scopedslots/" class="post-title-link" itemprop="url">vm.$slots和vm.$scopedSlots 在渲染函数内的使用</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:50:21" itemprop="dateCreated datePublished" datetime="2019-02-28T15:50:21+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以下例子是在 <a href="mailto:Vue@2.6.2" target="_blank" rel="noopener">Vue@2.6.2</a> 中运行的。</p>
<p><code>vm.$slots</code> 与 <code>vm.$scopedSlots</code> 是两个与插槽相关的属性。在使用渲染函数替代 vue 的模板功能时我们可能需要用到这两个属性来实现插槽的功能。</p>
<p>下面利用一个例子来研究 <code>vm.$slots</code> <code>vm.$scopedSlots</code> 的区别。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">HelloWorld</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">slot</span>=<span class="string">"head"</span> <span class="attr">slot-scope</span>=<span class="string">"&#123;author&#125;"</span>&gt;</span>this is head slot -- &#123;&#123;author&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>this is default slot<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"foot"</span>&gt;</span>this is foot slot<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">HelloWorld</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 后面代码 略 --&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HelloWorld.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"head"</span> <span class="attr">author</span>=<span class="string">"Allen"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"aside"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"foot"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 后面代码 略 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们在 <code>HelloWorld.vue</code> 内定义三个具名插槽和一个默认插槽。在 <code>App.vue</code> 内实例化 HelloWorld 组件时，只使用了 <code>head</code> <code>default</code> <code>foot</code> 插槽，其中 <code>head</code> 插槽是一个作用域插槽。</p>
<p>然后我们将 <code>vm.$slots</code> <code>vm.$scopedSlots</code>打印的到控制台上，chrome 浏览器上打印的结果如下：</p>
<h4 id="vm-slots"><a href="#vm-slots" class="headerlink" title="vm.\$slots"></a>vm.\$slots</h4><p><img src="https://note.youdao.com/yws/res/4098/EB147A0005BE49C4BE7E572B7767079F" alt="vm.$slots"></p>
<p>观察发现</p>
<ul>
<li>只有被使用到的插槽才会出现在 <code>vm.$slots</code> 内。</li>
<li>默认插槽和具名插槽的值是虚拟 dom 数组（<code>VNode[]</code>）,作用域插槽对应的值是一个 <code>get</code> 方法且属性修饰为不可枚举。</li>
</ul>
<h4 id="vm-scopedSlots"><a href="#vm-scopedSlots" class="headerlink" title="vm.\$scopedSlots"></a>vm.\$scopedSlots</h4><p><img src="https://note.youdao.com/yws/res/4100/F15683549E22485EBEED1246DCB44F0E" alt="vm.$scopedSlots"></p>
<p>观察发现</p>
<ul>
<li>只有被使用到的插槽才会出现在 <code>vm.$scopedSlots</code> 内。</li>
<li>这里面多了 <code>$stable</code> <code>_normalized</code> 属性。具体什么作用，未知。</li>
<li>无论是具名插槽、默认插槽、作用域插槽都在，而且值是一个工厂函数，调用后会返回虚拟 dom 数组（<code>VNode[]</code>）。</li>
<li>作用域插槽对应的函数内多个参数 <code>scope</code>，可以通过它将参数传给插槽。</li>
<li>所有值都是可枚举的。</li>
</ul>
<h2 id="vm-slots-在开发中的使用"><a href="#vm-slots-在开发中的使用" class="headerlink" title="vm.\$slots 在开发中的使用"></a>vm.\$slots 在开发中的使用</h2><p>以下例子来自 Vue 官方文档，仅做了些许的改动。</p>
<h3 id="简单的例子"><a href="#简单的例子" class="headerlink" title="简单的例子"></a>简单的例子</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyHeadline.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"MyHeadline"</span>,</span></span><br><span class="line"><span class="undefined">    props: &#123;</span></span><br><span class="line"><span class="undefined">      level: &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">        required: <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    render(createElement) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> createElement(<span class="string">"h"</span> + <span class="keyword">this</span>.level, <span class="keyword">this</span>.$slots.default);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"1"</span>&gt;</span>这是level 1<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"2"</span>&gt;</span>这是level 2<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"3"</span>&gt;</span>这是level 3<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"4"</span>&gt;</span>这是level 4<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"5"</span>&gt;</span>这是level 5<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyHeadline</span> <span class="attr">:level</span>=<span class="string">"6"</span>&gt;</span>这是level 6<span class="tag">&lt;/<span class="name">MyHeadline</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 后面代码 略 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>页面渲染的结果：</p>
<p><img src="https://note.youdao.com/yws/res/4101/0E93C9D17EF543CAAD51705E67B781ED" alt="渲染结果"></p>
<p>页面的 html 结构：</p>
<p><img src="https://note.youdao.com/yws/res/4099/CCAF184EDE8348D7A9047FED4DE328E1" alt="html结构"></p>
<p><code>MyHeadline</code> 组件的目的很明显，就是根据传入的 <code>level</code> 属性生成对应级别的 h 标签。使用 vue 的模板是很难实现这样的功能的，所以这里用到了 vue 的渲染函数（其实 vue 模板最终也是编译成渲染函数）。</p>
<h3 id="进阶例子"><a href="#进阶例子" class="headerlink" title="进阶例子"></a>进阶例子</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- AnchoredHeading.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> getChildrenTextContent = <span class="function"><span class="keyword">function</span>(<span class="params">children</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> children</span></span><br><span class="line"><span class="javascript">      .map(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> node.children</span></span><br><span class="line"><span class="undefined">          ? getChildrenTextContent(node.children)</span></span><br><span class="line"><span class="undefined">          : node.text;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="javascript">      .join(<span class="string">""</span>);</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"AnchoredHeading"</span>,</span></span><br><span class="line"><span class="undefined">    props: &#123;</span></span><br><span class="line"><span class="undefined">      level: &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="built_in">Number</span>,</span></span><br><span class="line"><span class="javascript">        required: <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    render(createElement) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建 kebab-case 风格的ID</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> headingId = getChildrenTextContent(<span class="keyword">this</span>.$slots.default)</span></span><br><span class="line"><span class="undefined">        .toLowerCase()</span></span><br><span class="line"><span class="javascript">        .replace(<span class="regexp">/\W+/g</span>, <span class="string">"-"</span>)</span></span><br><span class="line"><span class="javascript">        .replace(<span class="regexp">/(^\-|\-$)/g</span>, <span class="string">""</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> createElement(<span class="string">"h"</span> + <span class="keyword">this</span>.level, [</span></span><br><span class="line"><span class="undefined">        createElement(</span></span><br><span class="line"><span class="javascript">          <span class="string">"a"</span>,</span></span><br><span class="line"><span class="undefined">          &#123;</span></span><br><span class="line"><span class="undefined">            attrs: &#123;</span></span><br><span class="line"><span class="undefined">              name: headingId,</span></span><br><span class="line"><span class="javascript">              href: <span class="string">"#"</span> + headingId</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;,</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.$slots.default</span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">      ]);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"1"</span>&gt;</span>chapter 1 love<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"2"</span>&gt;</span>chapter 2 marry<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"3"</span>&gt;</span>chapter 3 rival<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"4"</span>&gt;</span>chapter 4 hate<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"5"</span>&gt;</span>chapter 5 divorce<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">:level</span>=<span class="string">"6"</span>&gt;</span>chapter 6 真香<span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 后面代码 略 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>页面渲染结果：</p>
<p><img src="https://note.youdao.com/yws/res/4137/D580782D95F743839C502CDDFFC17897" alt="渲染结果2"></p>
<p>页面 html 结构：</p>
<p><img src="https://note.youdao.com/yws/res/4136/19E72031A54E4B6DAD7A7B8B21D9C002" alt="html结构2"></p>
<h2 id="vm-scopedSlots-在开发中的使用"><a href="#vm-scopedSlots-在开发中的使用" class="headerlink" title="vm.\$scopedSlots 在开发中的使用"></a>vm.\$scopedSlots 在开发中的使用</h2><h3 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Menu.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"Menu"</span>,</span></span><br><span class="line"><span class="undefined">    render(createElement) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> createElement(</span></span><br><span class="line"><span class="javascript">        <span class="string">"div"</span>,</span></span><br><span class="line"><span class="javascript">        &#123; <span class="attr">class</span>: <span class="string">"menuBox"</span> &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.$scopedSlots.default(&#123; <span class="attr">title</span>: <span class="string">"🌎 菜单栏目 🌎"</span> &#125;)</span></span><br><span class="line"><span class="undefined">      );</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MenuItem.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"MenuItem"</span>,</span></span><br><span class="line"><span class="undefined">    render(createElement) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> createElement(<span class="string">"div"</span>, &#123; <span class="attr">class</span>: <span class="string">"MenuItem"</span> &#125;, <span class="keyword">this</span>.$slots.default);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">"&#123;title&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>产品<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>公司简介<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menuitem</span>&gt;</span>联系我们<span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 后面代码 略 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>Menu.vue</code>内我们通过<code>this.$scopedSlots.default({ title: &quot;🌎 菜单栏目 🌎&quot; })</code>向作用域插槽传了参数（<code>{ title: &quot;🌎 菜单栏目 🌎&quot; }</code>）。然后我们在 <code>App.vue</code> 内使用 <code>&lt;template slot-scope=&quot;{title}&quot;&gt;</code> 获得传过来的参数（这里用了解构赋值）。</p>
<p>上面只是为了展示<code>vm.$scopedSlots</code>在渲染函数内的使用，这个例子内的行为有点多此一举。</p>
<p>页面渲染结果：</p>
<p><img src="https://note.youdao.com/yws/res/4468/WEBRESOURCE882982210635beeed57bdfff7154dfb8" alt="scopedslots渲染结果.png"></p>
<p>页面 html 结构：</p>
<p><img src="https://note.youdao.com/yws/res/4470/WEBRESOURCE178ed95b3ed30d5d2c691c508c683530" alt="scopedslots_html结构.png"></p>
<h3 id="在渲染函数内插入作用域插槽"><a href="#在渲染函数内插入作用域插槽" class="headerlink" title="在渲染函数内插入作用域插槽"></a>在渲染函数内插入作用域插槽</h3><p>如果我们把上面那个例子里<code>App.vue</code>的模板写法改成渲染函数的话，我们该如何插入作用域插槽呢？</p>
<p>在模板写法内插入插槽很简单，只要在组件标签内插入即可。在渲染函数内需要用到<code>createElement</code>方法内的<code>scopedSlots</code>选项。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Menu <span class="keyword">from</span> <span class="string">"./components/Menu.vue"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MenuItem <span class="keyword">from</span> <span class="string">"./components/MenuItem.vue"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"app"</span>,</span></span><br><span class="line"><span class="undefined">    components: &#123;</span></span><br><span class="line"><span class="undefined">      Menu,</span></span><br><span class="line"><span class="undefined">      MenuItem</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    render(createElement) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> createElement(<span class="string">"div"</span>, &#123; <span class="attr">attrs</span>: &#123; <span class="attr">id</span>: <span class="string">"app"</span> &#125; &#125;, [</span></span><br><span class="line"><span class="javascript">        createElement(<span class="string">"Menu"</span>, &#123;</span></span><br><span class="line"><span class="undefined">          scopedSlots: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">default</span>: <span class="function">(<span class="params">&#123; title &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> [</span></span><br><span class="line"><span class="javascript">                createElement(<span class="string">"h4"</span>, title),</span></span><br><span class="line"><span class="javascript">                createElement(<span class="string">"MenuItem"</span>, <span class="string">"首页"</span>),</span></span><br><span class="line"><span class="javascript">                createElement(<span class="string">"MenuItem"</span>, <span class="string">"产品"</span>),</span></span><br><span class="line"><span class="javascript">                createElement(<span class="string">"MenuItem"</span>, <span class="string">"公司简介"</span>),</span></span><br><span class="line"><span class="javascript">                createElement(<span class="string">"MenuItem"</span>, <span class="string">"联系我们"</span>)</span></span><br><span class="line"><span class="undefined">              ];</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">      ]);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个写法和上面的模板写法的效果是等同的。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/defineProperty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/defineProperty/" class="post-title-link" itemprop="url">Object.defineProperty</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:49:00" itemprop="dateCreated datePublished" datetime="2019-02-28T15:49:00+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>Object.defineProperty</code> 可以给对象定义属性,以及属性的描述。</p>
<h2 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123; <span class="attr">name</span>: <span class="string">"Allen"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义属性 'gender'</span></span><br><span class="line"><span class="comment">// 可配置(configurable)</span></span><br><span class="line"><span class="comment">// 可枚举(enumerable)</span></span><br><span class="line"><span class="comment">// 可写(writable)</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"gender"</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">true</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  writable: <span class="literal">true</span>,</span><br><span class="line">  value: <span class="string">"man"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义'_birthday'</span></span><br><span class="line"><span class="comment">// 我们希望生日是不可改写的，</span></span><br><span class="line"><span class="comment">// 也不希望枚举对象的时候出现它</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"_birthday"</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  writable: <span class="literal">false</span>,</span><br><span class="line">  value: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"2000-03-03"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义'age'</span></span><br><span class="line"><span class="comment">// 年龄是通过生日获得的，并且不可改，</span></span><br><span class="line"><span class="comment">// 所以只需要设置get方法</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"age"</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  <span class="keyword">get</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear() - <span class="keyword">this</span>._birthday.getFullYear();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>configurable</code> 设置属性描述是否可修改。如果为 false,将无法对 <code>configurable</code> <code>enumerable</code> <code>writable</code> 的值进行修改。有一点例外： 当 <code>writable</code> 为 true 时，可以将其改为 false。</li>
<li><code>enumerable</code> 设置属性是否会在枚举的过程中出现。<code>for..in</code> <code>Object.keys</code> <code>Object.values</code> <code>Object.entries</code> 只会枚举属性描述 <code>enumerable</code> 为 true 的属性。其中 <code>for..in</code> 会将原型链上所有可枚举属性都遍历一遍。</li>
<li><code>writable</code> 设置属性是否可写。以上面的 <code>person</code> 对象为例，其中的 <code>_birthday</code> 属性是不可写的，假如你对它赋值（<code>person._birthday = new Date(&#39;2019-03-03&#39;)</code>）会没有效果，如果在严格模式下还会抛出异常。</li>
<li><code>value</code> 设置属性的值。</li>
<li><code>get</code> 读取属性的值。以上面 <code>person</code> 对象为例，当使用者要获取 <code>age</code> 的值时（<code>person.age</code>），获取的值就是 <code>get</code> 方法返回的值。</li>
<li><code>set</code> 写入属性的值。如果只有 <code>get</code> 没有 <code>set</code> 那么这个属性是不可写的。</li>
</ul>
<p>注意 <code>writable</code> <code>value</code>是一对，<code>get</code>方法 <code>set</code>方法是一对。有 <code>value</code> 就没有 <code>get</code> <code>set</code>。</p>
<h2 id="获取一个属性的描述"><a href="#获取一个属性的描述" class="headerlink" title="获取一个属性的描述"></a>获取一个属性的描述</h2><p>如果我们想知道一个属性描述可以使用 <code>Object.getOwnPropertyDescriptor</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(person, <span class="string">"age"</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/yield-delegation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/yield-delegation/" class="post-title-link" itemprop="url">yield-delegation</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:47:39" itemprop="dateCreated datePublished" datetime="2019-02-28T15:47:39+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在 generator 函数内部，通过<code>yield*</code>语句，可以将<code>yield</code>委托给其他任何实现<code>iterable</code>的对象。</p>
<h3 id="委托给-generator-函数生成的iterable对象"><a href="#委托给-generator-函数生成的iterable对象" class="headerlink" title="委托给 generator 函数生成的iterable对象"></a>委托给 generator 函数生成的<code>iterable</code>对象</h3><p>调用 generator 函数会返回一个实现<code>iterable</code>的对象(该对象同时也是一个<code>iterator</code>)。</p>
<p>通过<code>yield* otherGenerator()</code>可以将 generator 内的<code>yield</code>委托给其他 generator 生成的<code>iterable</code>对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"*foo() starting"</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"foo 1"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"foo 2"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"*foo() finished"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 1"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 2"</span>;</span><br><span class="line">  <span class="keyword">yield</span>* foo(); <span class="comment">// `yield`-delegation!</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 3"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line"></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "bar 1"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "bar 2"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// *foo() starting</span></span><br><span class="line"><span class="comment">// "foo 1"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "foo 2"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// *foo() finished</span></span><br><span class="line"><span class="comment">// "bar 3"</span></span><br></pre></td></tr></table></figure>
<p>可以看到上面的代码中，在调用第 3 个<code>next</code>方法时返回的是<code>foo</code>里面<code>yield</code>的<code>&quot;foo 1&quot;</code>；在调用第 5 个<code>next</code>时，并没有返回<code>foo</code> generator 隐式<code>return</code>的<code>undefined</code>,而是返回了<code>&quot;bar 3&quot;</code>。</p>
<p>如果<code>foo</code>内有显式的<code>return</code>语句，那么在进行 yield-delegation 时是否会返回<code>foo</code> <code>return</code>的值吗？</p>
<p>下面的代码在<code>foo</code>中添加了一个<code>return</code>语句。在<code>bar</code>内将<code>yield* foo()</code>表达式的值赋值给<code>tmp</code>变量并打印。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"*foo() starting"</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"foo 1"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"foo 2"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"*foo() finished"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"foo 3"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 1"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 2"</span>;</span><br><span class="line">  <span class="keyword">var</span> tmp = <span class="keyword">yield</span>* foo(); <span class="comment">// `yield`-delegation!</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"在bar内打印"</span>, tmp);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"bar 3"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line"></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "bar 1"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "bar 2"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// *foo() starting</span></span><br><span class="line"><span class="comment">// "foo 1"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// "foo 2"</span></span><br><span class="line">it.next().value;</span><br><span class="line"><span class="comment">// *foo() finished</span></span><br><span class="line"><span class="comment">// 在bar内打印 foo 3</span></span><br><span class="line"><span class="comment">// "bar 3"</span></span><br></pre></td></tr></table></figure>
<p>在第 5 次调用<code>next</code>方法时，可以发现<code>foo</code> <code>return</code>的<code>&quot;foo 3&quot;</code>变成了<code>yield* foo()</code>表达式的值，并被打印为<code>&quot;在bar内打印 foo 3&quot;</code>;<code>&quot;bar 3&quot;</code>成为<code>next</code>方法的返回值。</p>
<h3 id="委托给其他任何实现iterable的对象"><a href="#委托给其他任何实现iterable的对象" class="headerlink" title="委托给其他任何实现iterable的对象"></a>委托给其他任何实现<code>iterable</code>的对象</h3><p>generator 内部的<code>yield*</code>语句也能将<code>yield</code>委托给其他非 generator 生成的<code>iterable</code>对象。例如 数组就是一个实现了<code>iterable</code>的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span> <span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `yield`-delegation to a non-generator!</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span>* [<span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span> <span class="string">"E"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"F"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next().value);</span><br><span class="line"><span class="comment">// outside: A</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">1</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: 1</span></span><br><span class="line"><span class="comment">// outside: B</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">2</span>).value);</span><br><span class="line"><span class="comment">// outside: C</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">3</span>).value);</span><br><span class="line"><span class="comment">// outside: D</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">4</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: undefined</span></span><br><span class="line"><span class="comment">// outside: E</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">5</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: 5</span></span><br><span class="line"><span class="comment">// outside: F</span></span><br></pre></td></tr></table></figure>
<p>也可以委托给自己手写的<code>iterable</code>对象。由于 javascript 不是强类型语言，如果对象上含有<code>Symbol.iterator</code>方法，那么就可以将该对象当做一个<code>iterable</code>对象；如果对象上含有<code>next</code>方法，那就可以将该对象当做一个<code>iterator</code>对象。下面的<code>myIterable</code>对象即实现了<code>Symbol.iterator</code>方法也实现了<code>next</code>方法，所以它即是一个<code>iterable</code>又是一个<code>iterator</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myIterable = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  num: <span class="number">98</span>,</span><br><span class="line">  next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (self.num &lt; <span class="number">101</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="built_in">String</span>.fromCharCode(self.num++), <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="built_in">String</span>.fromCharCode(<span class="number">101</span>), <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span> <span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `yield`-delegation to a non-generator!</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span>* myIterable);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"inside `*bar()`:"</span>, <span class="keyword">yield</span> <span class="string">"E"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"F"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next().value);</span><br><span class="line"><span class="comment">// outside: A</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">1</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: 1</span></span><br><span class="line"><span class="comment">// outside: b</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">2</span>).value);</span><br><span class="line"><span class="comment">// outside: c</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">3</span>).value);</span><br><span class="line"><span class="comment">// outside: d</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">4</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: e</span></span><br><span class="line"><span class="comment">// outside: E</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">5</span>).value);</span><br><span class="line"><span class="comment">// inside `*bar()`: 5</span></span><br><span class="line"><span class="comment">// outside: F</span></span><br></pre></td></tr></table></figure>
<h3 id="异常委托"><a href="#异常委托" class="headerlink" title="异常委托"></a>异常委托</h3><p>被委托的<code>iterator</code>内部执行过程发生异常，如果异常被捕获，那么捕获处理完异常后还按原来的逻辑运行；如果异常未被捕获，那么异常会被抛出，异常会被抛到<code>yield*</code>语句那。下面是《YOU DON’T KNOW JS》内的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"B"</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"error caught inside `*foo()`:"</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"C"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="string">"D"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"A"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span>* foo();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"error caught inside `*bar()`:"</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"E"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span>* baz();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// note: can't get here!</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"G"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">"F"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next().value);</span><br><span class="line"><span class="comment">// outside: A</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">1</span>).value);</span><br><span class="line"><span class="comment">// outside: B</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.throw(<span class="number">2</span>).value);</span><br><span class="line"><span class="comment">// error caught inside `*foo()`: 2</span></span><br><span class="line"><span class="comment">// outside: C</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">3</span>).value);</span><br><span class="line"><span class="comment">// error caught inside `*bar()`: D</span></span><br><span class="line"><span class="comment">// outside: E</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"outside:"</span>, it.next(<span class="number">4</span>).value);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"error caught outside:"</span>, err);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error caught outside: F</span></span><br></pre></td></tr></table></figure>
<h3 id="递归委托"><a href="#递归委托" class="headerlink" title="递归委托"></a>递归委托</h3><p>下面是《YOU DON’T KNOW JS》里的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (val &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// generator recursion</span></span><br><span class="line">    val = <span class="keyword">yield</span>* foo(val - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> request(<span class="string">"http://some.url/?v="</span> + val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> r1 = <span class="keyword">yield</span>* foo(<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(r1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(bar);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/实现一个async函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/实现一个async函数/" class="post-title-link" itemprop="url">实现一个async函数</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:45:09" itemprop="dateCreated datePublished" datetime="2019-02-28T15:45:09+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>async 函数能将 promise 链式调用的写法改成同步的写法。让代码变得更简洁易懂。es6 中的 async 是语法糖，我们自己可以实现类似 async 函数的功能。</p>
<p>下面是<code>myAsync</code>的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; gen 一个generator函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAsync</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span><br><span class="line">    it;</span><br><span class="line">  it = gen.apply(<span class="keyword">this</span>, args);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">nextVal</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!nextVal.done) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(nextVal.value).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fn(it.next(v));</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fn(it.throw(err));</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(nextVal.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fn(it.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是测试用例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下面这个函数模拟异步请求返回一个promise</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; resource 资源的路径地址</span></span><br><span class="line"><span class="comment"> * @param &#123;Boolean&#125; success true表示能请求成功,false表示请求失败</span></span><br><span class="line"><span class="comment"> * @returns &#123;Promise&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">resource, success</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> randomTime = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">10</span>) * <span class="number">100</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(resource + <span class="string">" spend:"</span>, randomTime);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (success) &#123;</span><br><span class="line">        resolve(resource);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(resource);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, randomTime);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下面的generator函数写平常的业务逻辑。</span></span><br><span class="line"><span class="comment"> * 如果下面的console.time得出来的时间与三条请求的时间之和</span></span><br><span class="line"><span class="comment"> * 大约相等，说明main函数内的代码以类似同步的方式执行。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">"count"</span>);</span><br><span class="line">  <span class="keyword">var</span> rq1 = <span class="keyword">yield</span> request(<span class="string">"/request1"</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">var</span> rq2 = <span class="keyword">yield</span> request(<span class="string">"/request2"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> rq3 = <span class="keyword">yield</span> request(<span class="string">"/request3"</span>, <span class="literal">false</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"this is an error"</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rq4 = <span class="keyword">yield</span> request(<span class="string">"/request4"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">"count"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(returnValue);</span><br><span class="line">  <span class="keyword">return</span> returnValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myAsync(main, <span class="string">"hello my async"</span>);</span><br></pre></td></tr></table></figure>
<p>可以看出<code>main</code>函数内部写法和 es6 的 async 函数很相似，相当于将<code>await</code>替换成<code>yield</code>。</p>
<p>下面是 generator 中出现<code>yield</code>-delegation 中的测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里依赖上面的 myAsync 和 request 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">subTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rq2 = <span class="keyword">yield</span> request(<span class="string">"/request2"</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">var</span> rq3 = <span class="keyword">yield</span> request(<span class="string">"/request3"</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">var</span> rq4 = <span class="keyword">yield</span> request(<span class="string">"/request4"</span>, <span class="literal">false</span>); <span class="comment">// promise rejected</span></span><br><span class="line">  <span class="keyword">var</span> rq5 = <span class="keyword">yield</span> request(<span class="string">"/request5"</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">"count"</span>);</span><br><span class="line">  <span class="keyword">var</span> rq1 = <span class="keyword">yield</span> request(<span class="string">"/request1"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span>* subTask();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"catch error from subTask."</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rq5 = <span class="keyword">yield</span> request(<span class="string">"/request6"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">"count"</span>);</span><br><span class="line">  <span class="keyword">return</span> returnValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myAsync(main, <span class="string">"hello my async"</span>);</span><br></pre></td></tr></table></figure>
<p>上面的 main 方法内<code>yield*</code>语句将<code>yield</code>委托给了 subTask 方法，并且<code>subTask</code>内 req4 的 promise 被 rejected。此时的 myAsync 还能正常运行。</p>
<p>下面是 generator 中出现递归委托的测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里依赖上面的 myAsync 和 request 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">subTask</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt; <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span>* subTask(num + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> request(<span class="string">"/request"</span> + num, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.time(<span class="string">"count"</span>);</span><br><span class="line">  <span class="keyword">var</span> rq1 = <span class="keyword">yield</span> request(<span class="string">"/request1"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span>* subTask(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rq4 = <span class="keyword">yield</span> request(<span class="string">"/request4"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">"count"</span>);</span><br><span class="line">  <span class="keyword">return</span> returnValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myAsync(main, <span class="string">"hello my async"</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/generator内部抛出异常时的执行机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/generator内部抛出异常时的执行机制/" class="post-title-link" itemprop="url">generator内部抛出异常时的执行机制</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:42:22" itemprop="dateCreated datePublished" datetime="2019-02-28T15:42:22+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>执行 generator 函数会返回一个 iterator,iterator 调用<code>next</code>方法会返回一个值。如果<code>next</code>执行过程中出现异常是否还会返回值呢？如果返回值的话，会返回那个值呢？</p>
<h4 id="情况一：捕获的异常"><a href="#情况一：捕获的异常" class="headerlink" title="情况一：捕获的异常"></a>情况一：捕获的异常</h4><p><code>main</code> generator 内出现了一个被捕获的异常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    undefinedValue.sayHello(); <span class="comment">// 这里会出现ReferenceError</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"捕获了异常"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it = main();</span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// 捕获了异常</span></span><br><span class="line"><span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// &#123;value: 4, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>第二个<code>next</code>方法被调用时，打印了“捕获了异常”的字样，并返回了 <code>{value: 3, done: false}</code>。说明<code>yield 2</code>被跳过，并执行<code>yield 3</code>。</p>
<h4 id="情况二：未捕获的异常"><a href="#情况二：未捕获的异常" class="headerlink" title="情况二：未捕获的异常"></a>情况二：未捕获的异常</h4><p><code>main</code> generator 内出现了一个未被捕获的异常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    undefinedValue.sayHello();<span class="comment">// 这里会出现ReferenceError</span></span><br><span class="line">	<span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it=main();</span><br><span class="line">it.next()；</span><br><span class="line"><span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.next()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'测试是否会打印'</span>)</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: undefinedValue is not defined</span></span><br><span class="line"><span class="comment">//     at main (&lt;anonymous&gt;:4:5)</span></span><br><span class="line"><span class="comment">//     at main.next (&lt;anonymous&gt;)</span></span><br><span class="line"><span class="comment">//     at &lt;anonymous&gt;:1:4</span></span><br><span class="line">it</span><br><span class="line"><span class="comment">// main &#123;&lt;closed&gt;&#125;</span></span><br></pre></td></tr></table></figure>
<p>第二个<code>next</code>方法被调用时直接抛出了异常，并且后面的<code>console.log(&#39;测试是否会打印&#39;)</code>没被执行。再次查看<code>it</code>时，发现它的状态变成了<code>closed</code>。</p>
<h4 id="情况三：通过-iterator-的throw方法产生的异常"><a href="#情况三：通过-iterator-的throw方法产生的异常" class="headerlink" title="情况三：通过 iterator 的throw方法产生的异常"></a>情况三：通过 iterator 的<code>throw</code>方法产生的异常</h4><p>我们在第二个<code>next</code>方法之后调用 iterator 的<code>throw</code>方法产生一个异常，该异常刚好被<code>try..catch</code>捕获。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it = main();</span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">it.throw(<span class="string">"异常"</span>);</span><br><span class="line"><span class="comment">// 异常</span></span><br><span class="line"><span class="comment">// &#123;value: 4, done: false&#125;</span></span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// &#123;value: 5, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们在第二个<code>next</code>方法后面调用 iterator 的<code>throw</code>方法产生一个异常，此时的异常出现在<code>yield 2</code>的位置，并被<code>try..catch</code>捕获处理，所以程序跳过了<code>yield 3</code>执行了<code>yield 4</code>。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>如果 generator’s iterator 调用<code>next</code>的过程中遇到被捕获的异常，它处理完异常后会继续运行，直到碰到<code>yield</code> <code>return</code>或函数的结尾。如果遇到的是未被捕获的异常，它将抛出异常，并且 iterator 的状态变为<code>closed</code>。通过 iterator 的<code>throw</code>方法产生的异常和普通的异常是一样的执行逻辑。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/javascript中内建类型的判断/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/javascript中内建类型的判断/" class="post-title-link" itemprop="url">javascript中内建类型的判断</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:41:01" itemprop="dateCreated datePublished" datetime="2019-02-28T15:41:01+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>javascript 中内建类型（built-in types）有七个,包括 <code>null</code> <code>undefined</code> <code>boolean</code> <code>number</code> <code>string</code> <code>symbol</code> <code>object</code>。其中除了 <code>object</code> 外，另外的 6 个类型都是原始（primitive）类型。javascript 内的函数和数组都是 <code>object</code> 类型。</p>
<p>在平时工作中，我们需要判断数据的类型。</p>
<h2 id="用-typeof-来区分内建类型"><a href="#用-typeof-来区分内建类型" class="headerlink" title="用 typeof 来区分内建类型"></a>用 <code>typeof</code> 来区分内建类型</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// "object"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// "undefined"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span>; <span class="comment">// "boolean"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">10</span>; <span class="comment">// "number"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">"hello"</span>; <span class="comment">// "string"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>(); <span class="comment">// "symbol"</span></span><br><span class="line"><span class="keyword">typeof</span> &#123; <span class="attr">name</span>: <span class="string">"Allen"</span> &#125;; <span class="comment">// "object"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// "object"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span> <span class="title">hi</span>(<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// "function"</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span>; <span class="comment">// "number"</span></span><br></pre></td></tr></table></figure>
<p>从上面的结果中可以看出 <code>typeof</code> 返回的结果基本是正确的,除了 <code>typeof null</code> 和 <code>typeof function</code>。</p>
<p><code>typeof nulll</code> 返回 <code>object</code> 是早期语言设计上的错误。由于太多代码利用了这个错误特性，所以浏览器基本上没可能去修正这个 bug 了，不然会导致更多的 bug。</p>
<p><code>typeof function hi(){}</code> 返回 <code>function</code> 看似很合理，其实 <code>function</code> 在 JS 内并不是顶级的内建类型，它是 <code>object</code> 的子类型，所以它返回 <code>object</code> 会更合理些。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/javascript中的稀疏数组和empty-slot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/javascript中的稀疏数组和empty-slot/" class="post-title-link" itemprop="url">javascript中的稀疏数组与empty slot</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:40:07" itemprop="dateCreated datePublished" datetime="2019-02-28T15:40:07+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// no `a[1]` slot set here</span></span><br><span class="line">a[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">a[<span class="number">1</span>]; <span class="comment">// undefined;</span></span><br><span class="line"></span><br><span class="line">a.lenght; <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>这里产生了一个稀疏数组，<code>a[1]</code>这里是一个 empty slot。在谷歌浏览器控制台内显示样子如下：</p>
<p><img src="https://note.youdao.com/yws/res/4863/WEBRESOURCEe5262cded20050416ff8700a81554beb" alt="稀疏数组.png"></p>
<p><code>delete</code> 操作符也能产生一个 empty,以上面的数组<code>a</code>为例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> a[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// [1, empty x 2]</span></span><br></pre></td></tr></table></figure>
<p>在谷歌浏览器控制台内显示样子如下：</p>
<p><img src="https://note.youdao.com/yws/res/4873/WEBRESOURCE71e831eef536015e7a107f31ecf48f0f" alt="delete一个属性.png"></p>
<p>用<code>new Array(3)</code>方法也会生成 empty slot。</p>
<h2 id="empty和刻意赋值为undefined有差别吗？"><a href="#empty和刻意赋值为undefined有差别吗？" class="headerlink" title="empty和刻意赋值为undefined有差别吗？"></a><code>empty</code>和刻意赋值为<code>undefined</code>有差别吗？</h2><p>从第一个例子看到，<code>a[1]</code>返回的值是<code>undefined</code>。那么这和我们直接赋值<code>a[1]</code>为<code>undefined</code>有差别吗？</p>
<p>有差别。看下面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, , <span class="number">3</span>]; <span class="comment">// [1,empty,3]</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">3</span>]; <span class="comment">// [1,undefined,3]</span></span><br><span class="line"></span><br><span class="line">a.map(<span class="function"><span class="params">v</span> =&gt;</span> v * <span class="number">2</span>); <span class="comment">// [2,empty,6]</span></span><br><span class="line">b.map(<span class="function"><span class="params">v</span> =&gt;</span> v * <span class="number">2</span>); <span class="comment">// [2, NaN, 6]</span></span><br></pre></td></tr></table></figure>
<p>我们发现，<code>map</code>方法会跳过<code>a</code>数组的 empty slot,而不会跳过被显式设为<code>undefined</code>的<code>b[1]</code>项。</p>
<p>不仅仅是<code>map</code>方法，还有很多与遍历数组相关的操作都为跳过 empty slot。</p>
<p>我测试了所有我能想到与数组相关的操作，列出了以下两个列表。</p>
<h4 id="会跳过-empty-slot-的操作"><a href="#会跳过-empty-slot-的操作" class="headerlink" title="会跳过 empty slot 的操作"></a>会跳过 empty slot 的操作</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, , <span class="number">3</span>];</span><br><span class="line"><span class="comment">// [1,empty,3]</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">3</span>];</span><br><span class="line"><span class="comment">// [1,undefined,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// map方法</span></span><br><span class="line">a.map(<span class="function"><span class="params">v</span> =&gt;</span> v * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// [2,empty,6]</span></span><br><span class="line">b.map(<span class="function"><span class="params">v</span> =&gt;</span> v * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// [2, NaN, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach方法</span></span><br><span class="line">a.forEach(<span class="function">(<span class="params">v, k</span>) =&gt;</span> <span class="built_in">console</span>.log(v, k));</span><br><span class="line"><span class="comment">// 1 0</span></span><br><span class="line"><span class="comment">// 3 2</span></span><br><span class="line">b.forEach(<span class="function">(<span class="params">v, k</span>) =&gt;</span> <span class="built_in">console</span>.log(v, k));</span><br><span class="line"><span class="comment">// 1 0</span></span><br><span class="line"><span class="comment">// undefined 1</span></span><br><span class="line"><span class="comment">// 3 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter方法</span></span><br><span class="line">a.filter(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> (v + <span class="string">"a"</span>) === <span class="string">"string"</span>);</span><br><span class="line"><span class="comment">// [1,3]</span></span><br><span class="line">b.filter(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> (v + <span class="string">"a"</span>) === <span class="string">"string"</span>);</span><br><span class="line"><span class="comment">// [1, undefined, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// some方法</span></span><br><span class="line">a.some(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> v === <span class="string">"undefined"</span>);</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line">a.some(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> v === <span class="string">"undefined"</span>);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// every方法</span></span><br><span class="line">a.every(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> v === <span class="string">"number"</span>);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">b.every(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">typeof</span> v === <span class="string">"number"</span>);</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce方法</span></span><br><span class="line">a.reduce(<span class="function">(<span class="params">ac, v</span>) =&gt;</span> ac + v, <span class="string">""</span>);</span><br><span class="line"><span class="comment">// "13"</span></span><br><span class="line">b.reduce(<span class="function">(<span class="params">ac, v</span>) =&gt;</span> ac + v, <span class="string">""</span>);</span><br><span class="line"><span class="comment">// "1undefined3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reduceRight方法</span></span><br><span class="line">a.reduceRight(<span class="function">(<span class="params">ac, v</span>) =&gt;</span> ac + v, <span class="string">""</span>);</span><br><span class="line"><span class="comment">// "31"</span></span><br><span class="line">b.reduceRight(<span class="function">(<span class="params">ac, v</span>) =&gt;</span> ac + v, <span class="string">""</span>);</span><br><span class="line"><span class="comment">// "3undefined1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// indexOf方法</span></span><br><span class="line">a.indexOf(<span class="literal">undefined</span>); <span class="comment">// false</span></span><br><span class="line">b.indexOf(<span class="literal">undefined</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for..in 循环</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> b) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// in 操作符</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">in</span> a;</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">in</span> b;</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.keys方法</span></span><br><span class="line"><span class="built_in">Object</span>.keys(a);</span><br><span class="line"><span class="comment">// ["0", "2"]</span></span><br><span class="line"><span class="built_in">Object</span>.keys(b);</span><br><span class="line"><span class="comment">// ["0", "1", "2"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.values方法</span></span><br><span class="line"><span class="built_in">Object</span>.values(a);</span><br><span class="line"><span class="comment">// [1, 3]</span></span><br><span class="line"><span class="built_in">Object</span>.values(b);</span><br><span class="line"><span class="comment">// [1, undefined, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.entries方法</span></span><br><span class="line"><span class="built_in">Object</span>.entries(a);</span><br><span class="line"><span class="comment">// [["0",1],["2",3]]</span></span><br><span class="line"><span class="built_in">Object</span>.entries(b);</span><br><span class="line"><span class="comment">// [["0",1],["1", undefined],["2",3]]</span></span><br></pre></td></tr></table></figure>
<h4 id="不会跳过-empty-slot-的操作"><a href="#不会跳过-empty-slot-的操作" class="headerlink" title="不会跳过 empty slot 的操作"></a>不会跳过 empty slot 的操作</h4><p>以下列出我们可能误以为会跳过 empty slot 的操作，实际上下面的操作不会跳过 empty slot。尤其是下面的<code>for..of</code>操作需要特别注意。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,,<span class="number">3</span>]; <span class="comment">// [1,empty,3]</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">1</span>,<span class="literal">undefined</span>,<span class="number">3</span>]; <span class="comment">// [1,undefined,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// find方法,该方法返回找到的第一个符合条件的值</span></span><br><span class="line"><span class="comment">// find回调方法内理应返回一个boolean值，下面的写法是没什么用的，仅仅只是为了测试</span></span><br><span class="line">a.find(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="built_in">console</span>.log(v)&#125;);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">b.find(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="built_in">console</span>.log(v)&#125;);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// findIndex方法，同上。</span></span><br><span class="line"><span class="comment">// 不同的是findIndex返回的是索引值</span></span><br><span class="line">a.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="built_in">console</span>.log(v)&#125;);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">b.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="built_in">console</span>.log(v)&#125;);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for..of 循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> v <span class="keyword">of</span> a)&#123;<span class="built_in">console</span>.log(v)&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> v <span class="keyword">of</span> b)&#123;<span class="built_in">console</span>.log(v)&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面的三个方法看起来与Object构造函数上的keys values entries方法很像，</span></span><br><span class="line"><span class="comment">// 但是他们不会跳过empty slot,而且返回的值是Iterator而不是数组。</span></span><br><span class="line"><span class="comment">// 我们可以用扩展运算符将Iterator内的值取出，并放到数组内</span></span><br><span class="line"><span class="comment">// Array.prototype.keys方法</span></span><br><span class="line">[...a.keys()]</span><br><span class="line"><span class="comment">// [0, 1, 2]</span></span><br><span class="line">[...b.keys()]</span><br><span class="line"><span class="comment">// [0, 1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array.prototype.values方法</span></span><br><span class="line">[...a.values()]</span><br><span class="line"><span class="comment">// [1, undefined, 3]</span></span><br><span class="line">[...b.values()]</span><br><span class="line"><span class="comment">// [1, undefined, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array.prototype.entries方法</span></span><br><span class="line">[...a.entries()]</span><br><span class="line"><span class="comment">// [[0,1],[1,undefined], [2,3]]</span></span><br><span class="line">[...b.entries()]</span><br><span class="line"><span class="comment">// [[0,1],[1,undefined], [2,3]]</span></span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不给数组内的某个 slot 赋值,或使用<code>delete</code>操作数组，或用<code>new Array</code>生成数组都会生成 empty slot。大部分与遍历相关的方法和操作会跳过 empty slot；但有几个操作例外，尤其要注意<code>for..of</code>循环。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/javascript中的undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/javascript中的undefined/" class="post-title-link" itemprop="url">javascript中的undefined</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:38:50" itemprop="dateCreated datePublished" datetime="2019-02-28T15:38:50+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>javascript 中的<code>undefined</code>有很多的迷惑性，非常让人难以理解。</p>
<h2 id="undefined-等同于-“未声明”-吗？"><a href="#undefined-等同于-“未声明”-吗？" class="headerlink" title="undefined 等同于 “未声明” 吗？"></a><code>undefined</code> 等同于 “未声明” 吗？</h2><p><code>undefined</code>中文意思为“未定义”，我们可能就会认为<code>undefined</code>就是变量“未声明”。</p>
<p>但其实并不是这样，看下面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// undefined</span></span><br><span class="line">b; <span class="comment">// ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>
<p>我们只声明了变量<code>a</code>，但获取<code>a</code>时，返回的结果是<code>undefined</code>,获取<code>b</code>时抛出了一个异常。</p>
<p>这说明<code>undefined</code>不是“未声明”的意思，在引用“未声明”的变量时会抛出<code>ReferenceError</code>的异常。</p>
<h3 id="安全守卫（safety-guard）"><a href="#安全守卫（safety-guard）" class="headerlink" title="安全守卫（safety guard）"></a>安全守卫（safety guard）</h3><p>上面的例子说明了“未声明”的变量在引用时会抛出异常。但是我们的代码有时需要依赖全局的某个变量,而且我们不知道该变量是否已被声明。我们可能会像下面那样写一个<code>if</code>语句来判断该变量是否存在。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Debugging is starting"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面例子中，如果<code>DEBUG</code>并未被声明的话，会抛出<code>ReferenceError</code>并打断了代码的运行。我们需要的是当<code>DEBUG</code>为 true 时，执行内部的逻辑，<code>DEBUG</code>为 falsy 或“未声明”时，跳过里面的代码，而不是抛出异常。</p>
<p>以下有多种方式实现一个安全守卫，防止 javascript 抛出异常。</p>
<h5 id="方法-1：typeof"><a href="#方法-1：typeof" class="headerlink" title="方法 1：typeof"></a>方法 1：<code>typeof</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> a; <span class="comment">// "undefined"</span></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">// "undefined"</span></span><br></pre></td></tr></table></figure>
<p>从上面的例子中可以发现，无论是已声明的还是未声明的变量，<code>typeof</code> 返回的结果都是<code>undefined</code>，而且<code>typeof b</code>也不会抛出异常。</p>
<p>可以利用这个特性，作为一个 safety guard。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> DEBUG !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Debugging is starting"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="方法-2：对象属性"><a href="#方法-2：对象属性" class="headerlink" title="方法 2：对象属性"></a>方法 2：对象属性</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name: <span class="string">"Allen"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">person.gender; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>上面的例子中可以得出，访问一个未定义的对象属性不会抛出异常。</p>
<p>我们知道，javascript 中全局的变量，其实就是<code>window</code>对象上的属性。结合上面得出的结论，我们可以利用该特性，实现 safety guard。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.DEBUG) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Debugging is starting"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，这个方法，不利与跨平台，应为在 nodejs 中没有<code>window</code>对象。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://allenmrbai.github.io/2019/02/28/json/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="记录学习的过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Allen's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/json/" class="post-title-link" itemprop="url">javascript API JSON</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2019-02-28 15:37:09" itemprop="dateCreated datePublished" datetime="2019-02-28T15:37:09+08:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2025-04-24 17:20:11" itemprop="dateModified" datetime="2025-04-24T17:20:11+08:00">2025-04-24</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>所有 javascript 内所有 JSON-safe 的值都可以被 <code>JSON.stringify</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(<span class="number">42</span>);</span><br><span class="line"><span class="comment">// "42"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="string">"42"</span>);</span><br><span class="line"><span class="comment">// ""42"" (a string with a quoted string value in it)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// "null"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// "true"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">name</span>: <span class="string">"Allen"</span>, <span class="attr">hobby</span>: <span class="string">"painting"</span> &#125;);</span><br><span class="line"><span class="comment">// "&#123;"name":"Allen","hobby":"painting"&#125;"</span></span><br></pre></td></tr></table></figure>
<h2 id="JSON-safe-的值"><a href="#JSON-safe-的值" class="headerlink" title="JSON-safe 的值"></a>JSON-safe 的值</h2><p>什么是 JSON-safe 的值呢？我的理解是不方便跨语言的值都不是 JSON-safe 的。例如 <code>undefined</code> <code>function</code> <code>symbol</code> 还有循环引用的 <code>object</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非JSON-safe的值会被略掉</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组内非JSON-safe的值会被替换为null</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify([<span class="number">1</span>, <span class="literal">undefined</span>, <span class="string">"a"</span>]); <span class="comment">// "[1,null,"a"]"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象内非JSON-safe的值会被排除掉</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">name</span>: <span class="string">"Allen"</span>, <span class="attr">age</span>: <span class="literal">undefined</span> &#125;); <span class="comment">// "&#123;"name":"Allen"&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环引用的对象会报错</span></span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">name</span>: <span class="string">"outer"</span> &#125;;</span><br><span class="line">a.b = &#123; <span class="attr">name</span>: <span class="string">"inner"</span>, <span class="attr">outer</span>: a &#125;;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(a);</span><br></pre></td></tr></table></figure>
<h2 id="toJSON-方法"><a href="#toJSON-方法" class="headerlink" title="toJSON 方法"></a>toJSON 方法</h2><p>当对一个对象直接 stringify 的结果不是我们想要的，或者那个对象含循环引用时，我们可以在该对象上定义一个<code>toJSON</code>方法来自定义它需要返回的结果。返回的结果得是 JSON-safe 的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  b: <span class="number">42</span>,</span><br><span class="line">  c: o,</span><br><span class="line">  d: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a circular reference inside `a`</span></span><br><span class="line">o.e = a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// would throw an error on the circular reference</span></span><br><span class="line"><span class="comment">// JSON.stringify( a );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// define a custom JSON value serialization</span></span><br><span class="line">a.toJSON = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// only include the `b` property for serialization</span></span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">b</span>: <span class="keyword">this</span>.b &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a); <span class="comment">// "&#123;"b":42&#125;"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(o); <span class="comment">// "&#123;"e":&#123;"b":42&#125;&#125;"</span></span><br></pre></td></tr></table></figure>
<h3 id="stringify-的第二个参数-replacer"><a href="#stringify-的第二个参数-replacer" class="headerlink" title="stringify 的第二个参数 replacer"></a>stringify 的第二个参数 replacer</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  b: <span class="number">42</span>,</span><br><span class="line">  c: <span class="string">"42"</span>,</span><br><span class="line">  d: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a, [<span class="string">"b"</span>, <span class="string">"c"</span>]); <span class="comment">// "&#123;"b":42,"c":"42"&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a, <span class="function"><span class="keyword">function</span>(<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (k !== <span class="string">"c"</span>) <span class="keyword">return</span> v;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// "&#123;"b":42,"d":[1,2,3]&#125;"</span></span><br></pre></td></tr></table></figure>
<p>如上所示，如果在第二个参数传入了一个字符串数组，那么 stringify 的过程中就会只保留对应的键值对。</p>
<p>如果在第二个参数传入一个函数，那么可以自定义需要保留的键值对。</p>
<h3 id="stringify-的第三个参数-space"><a href="#stringify-的第三个参数-space" class="headerlink" title="stringify 的第三个参数 space"></a>stringify 的第三个参数 space</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  b: <span class="number">42</span>,</span><br><span class="line">  c: <span class="string">"42"</span>,</span><br><span class="line">  d: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a, <span class="literal">null</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// "&#123;</span></span><br><span class="line"><span class="comment">//    "b": 42,</span></span><br><span class="line"><span class="comment">//    "c": "42",</span></span><br><span class="line"><span class="comment">//    "d": [</span></span><br><span class="line"><span class="comment">//       1,</span></span><br><span class="line"><span class="comment">//       2,</span></span><br><span class="line"><span class="comment">//       3</span></span><br><span class="line"><span class="comment">//    ]</span></span><br><span class="line"><span class="comment">// &#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a, <span class="literal">null</span>, <span class="string">"-----"</span>);</span><br><span class="line"><span class="comment">// "&#123;</span></span><br><span class="line"><span class="comment">// -----"b": 42,</span></span><br><span class="line"><span class="comment">// -----"c": "42",</span></span><br><span class="line"><span class="comment">// -----"d": [</span></span><br><span class="line"><span class="comment">// ----------1,</span></span><br><span class="line"><span class="comment">// ----------2,</span></span><br><span class="line"><span class="comment">// ----------3</span></span><br><span class="line"><span class="comment">// -----]</span></span><br><span class="line"><span class="comment">// &#125;"</span></span><br></pre></td></tr></table></figure>
<p>如上所示，第三个参数可以是数字，表示缩进的空格个数；也可以是字符串，表示占位的符号。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="博主">
            
              <p class="site-author-name" itemprop="name">博主</p>
              <p class="site-description motion-element" itemprop="description">记录学习的过程</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Allen Bai</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  



  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
